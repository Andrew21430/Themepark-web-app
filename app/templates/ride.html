{% extends 'layout.html' %}
{% block content %}


<div style="display: flex; flex-direction: row;">
    <!-- Height scale -->
    <div class="height-scale-container">
        <div class="height-scale-bg">
            <span class="height-scale-label">Height</span>
            <span id="height-scale-value" class="height-scale-value">--</span>
        </div>
        <span style="font-size:1em;color:#444;">metres</span>
    </div>

    <div style="flex:1">
        <form method="POST">
            {{ form.hidden_tag() }}
            {{ form.search.label }} {{ form.search(size=32) }}
            {{ form.submit() }}
        </form>

        <main class="twocol-grid" id="rides-list">
            {% for ride in rides %}
                {% set flipped = loop.index0 is even %}
                {% if flipped %}
                    <article class="ride-article" data-ride-id="{{ride.id}}" data-ride-height="{{ride.Height or 0}}">
                        <h1>{{ride.name}} {{ride.thrill_level}}</h1>
                        <p>{{ride.layout.description}}</p>
                        <a href="{{ url_for('review_page', ride_id=ride.id) }}" class="button">Review {{ ride.name }}</a>
                    </article>
                    <article>
                        <img class="widthhalf" src="/static/Images/website/rides/{{ride.photo}}">
                    </article>
                {% else %}
                    <article>
                        <img class="widthhalf" src="/static/Images/website/rides/{{ride.photo}}">
                    </article>
                    <article class="ride-article" data-ride-id="{{ride.id}}" data-ride-height="{{ride.Height or 0}}">
                        <h1>{{ride.name}} {{ride.thrill_level}}</h1>
                        <p>{{ride.layout.description}}</p>
                        <a href="{{ url_for('review_page', ride_id=ride.id) }}" class="button">Review {{ ride.name }}</a>
                    </article>
                {% endif %}
            {% endfor %}
        </main>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    function updateHeightScale() {
        const articles = Array.from(document.querySelectorAll('.ride-article'));
        if (!articles.length) return;
        const viewportMid = window.innerHeight / 2;
        let closest = null, minDist = Infinity;
        articles.forEach(article => {
            const rect = article.getBoundingClientRect();
            const articleMid = rect.top + rect.height / 2;
            const dist = Math.abs(articleMid - viewportMid);
            if (dist < minDist) {
                minDist = dist;
                closest = article;
            }
        });
        // Remove highlight
        articles.forEach(a => a.classList.remove('ride-highlight'));
        if (closest) {
            closest.classList.add('ride-highlight');
            document.getElementById('height-scale-value').textContent = closest.getAttribute('data-ride-height') || '--';
        }
    }
    // Run on scroll and on load
    window.addEventListener('scroll', updateHeightScale);
    window.addEventListener('resize', updateHeightScale);
    updateHeightScale();
});
</script>

<div id="bottom-content"></div>
{% endblock %}